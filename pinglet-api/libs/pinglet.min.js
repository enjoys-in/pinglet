const PingletWidget = ((e) => {
	let t;
	let n;
	let i;
	function o(e, t = {}) {
		const n = document.createElement("div");
		let o;
		(n.className = "pinglet-toast"),
			n.appendChild(e),
			(o = n),
			"fade" === t.transition &&
				((o.style.opacity = 0),
				(o.style.transition = "opacity 0.5s ease"),
				requestAnimationFrame(() => (o.style.opacity = 1)));
		document
			.querySelector("#pinglet-wrapper .pinglet-container")
			.appendChild(n),
			t.sound?.play && i?.play(),
			t.auto_dismiss &&
				setTimeout(() => {
					n.remove();
				}, t.duration || 3e3);
	}
	function a(e, t) {
		const n = document.createElement("div");
		if (
			((n.className = `pinglet-variant pinglet-${e.variant || "default"}`),
			e.media?.type)
		) {
			const t = ((e) => {
				switch (e.type) {
					case "image": {
						const t = document.createElement("img");
						return (t.src = e.src), (t.style.width = "100%"), t;
					}
					case "video": {
						const n = document.createElement("video");
						return (
							(n.src = e.src),
							(n.autoplay = !0),
							(n.muted = !0),
							(n.loop = !0),
							(n.style.width = "100%"),
							n
						);
					}
					case "audio": {
						const i = document.createElement("audio");
						return (i.src = e.src), (i.autoplay = !0), i;
					}
					case "icon": {
						const o = document.createElement("img");
						return (
							(o.src = e.src),
							(o.style.width = "30px"),
							(o.style.height = "30px"),
							o
						);
					}
					default:
						return null;
				}
			})(e.media);
			t && n.appendChild(t);
		}
		if (e.title) {
			const i = document.createElement("div");
			(i.className = "pinglet-title"),
				(i.innerText = e.title),
				Object.assign(i.style, t.heading),
				n.appendChild(i);
		}
		if (e.description) {
			const i = document.createElement("div");
			(i.className = "pinglet-desc"),
				(i.innerText = e.description),
				Object.assign(i.style, t.text),
				n.appendChild(i);
		}
		if (e.buttons) {
			const i = document.createElement("div");
			(i.className = "pinglet-buttons"),
				e.buttons.forEach((e, n) => {
					const o = document.createElement("button");
					(o.innerText = e.text),
						Object.assign(o.style, 0 === n ? t.btn1 : t.btn2),
						(o.onclick = new Function(e.onClick)),
						i.appendChild(o);
				}),
				n.appendChild(i);
		}
		return n;
	}
	const s = {
		btn1: { color: "#fff", backgroundColor: "#000" },
		btn2: { color: "#fff", backgroundColor: "#000" },
		text: {},
		heading: {},
		image: {},
		video: {},
	};
	const c = {
		async init({ endpoint: e, domain: c, projectId: l, pingletId: d }) {
			const r = await fetch(`${e}/load/${l}?domain=${c}`);
			const p = await r.json();
			if (!p || !p.success) return;
			const u = {
				...p.globalConfig,
				style: { ...s, ...p.globalConfig?.style },
			};
			!((e) => {
				(t = document.createElement("div")),
					(t.id = "pinglet-wrapper"),
					(t.style = `position:fixed;${
						e.position.includes("bottom") ? "bottom" : "top"
					}:0;left:0;right:0;z-index:999999;font-family:sans-serif`);
				const o = document.createElement("div");
				(o.className = "pinglet-container"),
					t.appendChild(o),
					(n = document.createElement("div")),
					(n.className = "pinglet-branding"),
					(n.innerHTML = e.branding?.html || ""),
					(n.style = "text-align:center;padding:5px;font-size:12px;color:#999"),
					t.appendChild(n),
					e.sound?.play && e.sound.src && (i = new Audio(e.sound.src)),
					document.body.appendChild(t);
			})(u);
			new EventSource(`${e}/stream/${d}`).onmessage = (e) => {
				o(a(JSON.parse(e.data), u.style), u);
			};
		},
	};
	return (e.PingletWidget = c), e;
})({});
